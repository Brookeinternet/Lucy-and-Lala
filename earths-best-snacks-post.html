<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Elmo Snacks & Happy Smiles - Lucy and Lala's Adventures</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800;900&family=Pacifico&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" />
  <style>
    body {font-family:'Inter',sans-serif; background:linear-gradient(to bottom,#ffe4f0,#fff);} 
    h1,h2,h3 {font-family:'Pacifico',cursive}
    .btn-primary {background-color:#ff89b3;color:#fff;transition:all .3s ease}
    .btn-primary:hover {background-color:#ff6b9d; transform:scale(1.05)}
    .like-button {cursor:pointer;font-size:2rem;color:#d1d5db;transition:color .3s ease, transform .3s ease}
    .like-button.liked {color:#ff6b9d; transform:scale(1.2)}
    /* Fullscreen overlays */
    .locked-overlay, .pro-content-overlay {position:fixed; inset:0; display:flex; flex-direction:column; justify-content:center; align-items:center; gap:12px; text-align:center; padding:2rem; z-index:9999; background:rgba(255,255,255,.98)}
    .locked-overlay h3, .pro-content-overlay h3 {color:#ef4444; font-size:2rem}
    .locked-overlay p, .pro-content-overlay p {color:#4b5563}
    .locked-overlay a, .pro-content-overlay a {background:#ef4444; color:#fff; padding:.75rem 1.5rem; border-radius:9999px; font-weight:700}
    .locked-overlay a:hover, .pro-content-overlay a:hover {background:#dc2626}
  </style>
</head>
<body class="antialiased text-gray-700">

  <!-- PAGE HEADER -->
  <header class="bg-gradient-to-r from-pink-300 to-pink-200 p-8 text-center rounded-b-3xl shadow-lg">
    <h1 class="text-5xl text-white drop-shadow-md">üç™ Elmo Snacks & Happy Smiles üíñ</h1>
    <p class="text-lg mt-2 text-white font-semibold">A cheesy and joyful snack time with Lucy and Lala! ‚ú®</p>
  </header>

  <!-- MAIN CONTENT -->
  <main class="max-w-4xl mx-auto p-6">
    <article class="bg-white rounded-3xl shadow-xl p-6 space-y-6">
      <h2 class="text-3xl text-pink-500 text-center">Snack Attack with Elmo Cheddar Crackers! üòã</h2>

      <div class="rounded-2xl overflow-hidden shadow-md">
        <img src="https://i.imgur.com/7mMNLsA.jpeg" alt="Lucy and Lala eating Elmo cheddar snacks" class="w-full object-cover"/>
      </div>
      <p>Lucy and Lala were absolutely delighted to munch on <a href="https://www.earthsbest.com/" target="_blank" class="text-pink-500 font-bold hover:underline">Earth's Best Organic Elmo Cheddar Crackers</a> ‚Äî adorable, cheesy little crackers shaped like Elmo, making snack time extra fun!</p>

      <p><strong>Did you know?</strong> Earth's Best, founded in 1985, is a pioneer in organic baby and toddler food. They prioritize non-GMO ingredients, avoid artificial flavors and preservatives, and use sustainable farming practices. Their dedication ensures every snack meets high nutritional standards while keeping flavors kid-approved.</p>

      <p><strong>Why Parents Love Them:</strong> Beyond the fun shapes, these crackers are baked (not fried), contain no hydrogenated oils, and are an excellent source of calcium. They also come in resealable packaging, making them perfect for on-the-go snacking.</p>

      <h3 class="text-2xl text-pink-500">Ingredients in Elmo Cheddar Crackers</h3>
      <ul class="list-disc pl-6 space-y-1">
        <li>Organic wheat flour</li>
        <li>Organic cheddar cheese (milk, cheese cultures, salt, enzymes)</li>
        <li>Organic sunflower oil</li>
        <li>Organic cane sugar</li>
        <li>Organic skim milk</li>
        <li>Sea salt</li>
        <li>Organic yeast</li>
        <li>Organic paprika (for color)</li>
        <li>Mixed tocopherols (Vitamin E, for freshness)</li>
      </ul>
      <p class="text-sm text-gray-500">*Always check the packaging for the most up-to-date ingredient list and allergen information.</p>

      <div class="rounded-2xl overflow-hidden shadow-md">
        <img src="https://i.imgur.com/jReBVTK.jpeg" alt="Close up of Elmo cheddar snacks" class="w-full object-cover"/>
      </div>
      <p>Just look at those perfectly shaped Elmo crackers! The vibrant cheddar color and fun shapes make them irresistible. Lucy and Lala giggled with every bite, picking their favorite Elmo faces before crunching down.</p>

      <div class="rounded-2xl overflow-hidden shadow-md">
        <img src="https://i.imgur.com/VqRJf5t.jpeg" alt="Lucy holding Elmo snack box" class="w-full object-cover"/>
      </div>
      <p>Lucy was especially proud to show off the bright and colorful Elmo snack box! The packaging itself sparks joy ‚Äî bold colors, friendly Elmo graphics, and clear labeling that reassures parents about the organic ingredients inside.</p>

      <div class="rounded-2xl overflow-hidden shadow-md">
        <img src="https://i.imgur.com/3BGURA1.jpeg" alt="Lala reaching for more crackers" class="w-full object-cover"/>
      </div>
      <p>Lala couldn‚Äôt resist reaching for more! These crackers are the perfect size for tiny hands, encouraging independence during snack time while still being easy for parents to portion and pack for school or outings.</p>

      <h3 class="text-2xl text-pink-500 mt-10">How to Get Clothes That Match Lucy and Lala‚Äôs Style</h3>
      <p>One of the most delightful parts of following Lucy and Lala‚Äôs adventures is seeing their coordinated, whimsical outfits. If you‚Äôve ever wanted to dress your little ones in styles just like theirs, the good news is that it‚Äôs totally possible! Start by paying attention to their signature look ‚Äî soft pastel colors, playful prints, and charming accessories. Think matching dresses with ruffled sleeves, sweet pinafores layered over t-shirts, or coordinated rompers in seasonal prints like cherries, florals, or polka dots.</p>
      <p>Many of their outfits come from popular children‚Äôs clothing brands like <strong>Little Me</strong>, <strong>Mini Boden</strong>, or <strong>Janie and Jack</strong>, which often release seasonal collections full of whimsical details. Shopping during sales or at outlet locations can make these high-quality pieces more affordable. Don‚Äôt overlook smaller boutique brands on Etsy or Instagram ‚Äî many offer handmade dresses and accessories that perfectly capture that "storybook" charm Lucy and Lala are known for.</p>
      <p>When recreating their look, accessories make all the difference: matching hair bows, knee-high socks, patterned tights, or sunhats can elevate even the simplest outfits. Look for sets so siblings or friends can coordinate without being identical ‚Äî for example, the same dress in two different pastel shades, or a romper and a dress in the same print. For photoshoots, try layering cardigans, adding playful shoes like Mary Janes or colorful sneakers, and finishing with a cute prop like a small wicker basket or a plush toy. The result? A polished, picture-perfect outfit that channels Lucy and Lala‚Äôs cutesy, joyful aesthetic.</p>

      <div class="flex flex-col items-center space-y-4">
        <i class="fas fa-heart like-button" onclick="this.classList.toggle('liked')"></i>
        <button class="btn-primary py-3 px-6 rounded-full font-bold shadow-lg">Like This Post ‚ù§Ô∏è</button>
      </div>
    </article>

    <div class="text-center mt-6">
      <a href="index.html" class="btn-primary py-3 px-6 rounded-full font-bold shadow-lg inline-block">Back to All Adventures üéÄ</a>
    </div>
  </main>

  <footer class="bg-white mt-12 py-6 text-center text-sm text-gray-500 border-t-4 border-pink-200">
    &copy; 2025 Lucy and Lala's Adventures. All rights reserved.
  </footer>

  <!-- ACCESS + LOCK LOGIC (admin-restricted fix + tests) -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
    import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
    import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

    // --- Config & Globals ---
    const appId = (typeof window !== 'undefined' && typeof window.__app_id !== 'undefined') ? window.__app_id : 'default-app-id';
    const initialAuthToken = (typeof window !== 'undefined' && typeof window.__initial_auth_token !== 'undefined') ? window.__initial_auth_token : null;

    const firebaseConfig = {
      apiKey: "AIzaSyBaVuIUd_iVRiR5LEeCoPtE0QphcxMLBQU",
      authDomain: "lucyandlala.firebaseapp.com",
      projectId: "lucyandlala",
      storageBucket: "lucyandlala.firebasestorage.app",
      messagingSenderId: "422161772278",
      appId: "1:422161772278:web:a39c41f9ad967d379886d7",
      measurementId: "G-JZJK3JWCKH"
    };

    let app = null, auth = null, db = null, currentUserId = null;

    if (firebaseConfig && firebaseConfig.apiKey) {
      app = initializeApp(firebaseConfig);
      auth = getAuth(app);
      db = getFirestore(app);
      console.log("Firebase services initialized.")
    } else {
      console.warn("Firebase config not found. Auth/Pro status disabled.");
    }

    // --- Helpers ---
    function isAdminRestrictedError(err){
      return !!(err && (err.code === 'auth/admin-restricted-operation' || /admin-restricted/i.test(err.message||'')));
    }

    async function safeClientSignIn(auth, token){
      if (!auth) return null;
      // If already signed in, no-op
      if (auth.currentUser) return auth.currentUser;

      // Prefer custom token only if provided; fallback to anonymous on any failure
      if (token && typeof token === 'string' && token.trim().length){
        try {
          const cred = await signInWithCustomToken(auth, token);
          return cred.user;
        } catch (e) {
          console.warn('Custom-token sign-in failed; falling back to anonymous:', e?.code || e);
          // Fall through to anonymous for admin-restricted and any other errors
        }
      }

      try {
        const cred = await signInAnonymously(auth);
        return cred.user;
      } catch (e) {
        console.warn('Anonymous sign-in failed (is it enabled in Firebase console?):', e?.code || e);
        return null; // Continue unauthenticated; Firestore read may be denied and we will treat as non-Pro
      }
    }

    async function getAuthenticatedUserId(){
      if (!auth) return null;
      return new Promise(resolve => {
        const unsub = onAuthStateChanged(auth, (user)=>{ unsub(); resolve(user ? user.uid : null); });
      });
    }

    async function getProSubscriberStatus(){
      if (!db) return false;
      const userId = await getAuthenticatedUserId();
      if (!userId) return false;
      try {
        const userDocRef = doc(db, `artifacts/${appId}/users/${userId}/profile`, 'subscription');
        const docSnap = await getDoc(userDocRef);
        if (docSnap.exists()) {
          const data = docSnap.data();
          return data.isProSubscriber === true;
        }
        return false;
      } catch (e) {
        // Permission-denied or other Firestore errors => treat as not Pro instead of crashing
        console.warn('Firestore read error (treating as non-Pro):', e?.code || e);
        return false;
      }
    }

    const releaseDate = new Date('2025-08-30T00:00:00');
    const currentDate = new Date();

    document.addEventListener('DOMContentLoaded', async () => {
      // Sign-in safely (no admin-only client calls). Falls back to anonymous, then no-auth.
      await safeClientSignIn(auth, initialAuthToken);

      if (currentDate < releaseDate) {
        // Date-locked overlay
        document.body.insertAdjacentHTML('beforeend', `
          <div class="locked-overlay" data-testid="locked-overlay">
            <h3>üîí Coming Soon!</h3>
            <p>This exclusive snack time adventure will be released on August 30th, 2025!</p>
            <p>Check back soon to see Lucy and Lala's cheesy grins!</p>
            <a href="toddler-blog" class="mt-4">Back to All Adventures! üéÄ</a>
          </div>`);
        document.body.style.overflow = 'hidden';
      } else {
        const isProSubscriber = await getProSubscriberStatus();
        if (!isProSubscriber) {
          const mainContent = document.querySelector('main');
          if (mainContent) {
            mainContent.insertAdjacentHTML('afterbegin', `
              <div class="pro-content-overlay" data-testid="pro-overlay">
                <h3>üîí Pro Content Only!</h3>
                <p>This exclusive snack time adventure is reserved for Lucy and Lala Pro Subscribers.</p>
                <a href="https://buy.stripe.com/eVq00ldtC8408cxfZwabK00" target="_blank">Unlock Now for $10/month!</a>
              </div>`);
            const article = mainContent.querySelector('article');
            if (article) { article.style.filter = 'blur(5px)'; article.style.pointerEvents = 'none'; }
          }
        }
      }

      // --- Test Suite (do not modify existing tests; add more below) ---
      (function runTests(){
        const results = [];
        const t = (name, pass) => { results.push({ test: name, pass: !!pass }); console.assert(pass, name); };
        try {
          // Existing tests
          t('initialAuthToken variable is defined', typeof initialAuthToken !== 'undefined');
          t('appId variable is defined', typeof appId !== 'undefined');
          t('releaseDate is a Date', releaseDate instanceof Date);
          if (currentDate < releaseDate) {
            t('Locked overlay injected before release date', !!document.querySelector('[data-testid="locked-overlay"]'));
          } else {
            t('Either article or pro overlay present after release', !!document.querySelector('article') || !!document.querySelector('[data-testid="pro-overlay"]'));
          }

          // Additional tests (new)
          t('isAdminRestrictedError identifies admin-restricted error', isAdminRestrictedError({ code: 'auth/admin-restricted-operation', message: 'admin restricted' }));
          t('isAdminRestrictedError returns false for null', !isAdminRestrictedError(null));
          t('safeClientSignIn function exists', typeof safeClientSignIn === 'function');
        } catch (e) {
          console.error('Test suite error:', e);
        } finally {
          console.table(results);
        }
      })();
    });
  </script>
</body>
</html>
